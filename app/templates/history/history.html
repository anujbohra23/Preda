{% extends 'base.html' %}
{% block title %}Session History{% endblock %}

{% block content %}

<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold text-slate-800">Session History</h1>
  <a href="{{ url_for('sessions.new_session') }}"
     class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold
            px-4 py-2 rounded-md transition-colors">
    + New Session
  </a>
</div>

{% if session_stats %}
<div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
  <table class="w-full text-sm">
    <thead class="bg-slate-50 border-b border-slate-200">
      <tr>
        <th class="text-left px-5 py-3 text-xs font-semibold text-slate-500
                   uppercase tracking-wide">Session</th>
        <th class="text-left px-5 py-3 text-xs font-semibold text-slate-500
                   uppercase tracking-wide">Status</th>
        <th class="text-center px-4 py-3 text-xs font-semibold text-slate-500
                   uppercase tracking-wide">Docs</th>
        <th class="text-center px-4 py-3 text-xs font-semibold text-slate-500
                   uppercase tracking-wide">Conditions</th>
        <th class="text-center px-4 py-3 text-xs font-semibold text-slate-500
                   uppercase tracking-wide">Messages</th>
        <th class="text-center px-4 py-3 text-xs font-semibold text-slate-500
                   uppercase tracking-wide">Reports</th>
        <th class="text-left px-5 py-3 text-xs font-semibold text-slate-500
                   uppercase tracking-wide">Created</th>
        <th class="px-4 py-3"></th>
      </tr>
    </thead>
    <tbody class="divide-y divide-slate-100">
      {% for stat in session_stats %}
      {% set s = stat.session %}
      <tr class="hover:bg-slate-50 transition-colors">
        <td class="px-5 py-3">
          <div class="font-medium text-slate-800 truncate max-w-[180px]">
            {{ s.title }}
          </div>
          {% if s.safety_flagged %}
            <span class="text-xs text-red-600">âš  Safety flag</span>
          {% endif %}
        </td>
        <td class="px-5 py-3">
          <span class="text-xs px-2 py-0.5 rounded-full font-medium
            {% if s.status == 'intake' %}bg-slate-100 text-slate-600
            {% elif s.status == 'reviewing' %}bg-amber-100 text-amber-700
            {% elif s.status == 'results' %}bg-blue-100 text-blue-700
            {% elif s.status == 'chat' %}bg-purple-100 text-purple-700
            {% elif s.status == 'report' %}bg-green-100 text-green-700
            {% else %}bg-slate-100 text-slate-500{% endif %}">
            {{ s.status | capitalize }}
          </span>
        </td>
        <td class="px-4 py-3 text-center text-slate-600">
          {{ stat.upload_count }}
        </td>
        <td class="px-4 py-3 text-center text-slate-600">
          {{ stat.disease_count }}
        </td>
        <td class="px-4 py-3 text-center text-slate-600">
          {{ stat.message_count }}
        </td>
        <td class="px-4 py-3 text-center text-slate-600">
          {{ stat.report_count }}
        </td>
        <td class="px-5 py-3 text-slate-400 text-xs">
          {{ s.created_at[:10] }}
        </td>
        <td class="px-4 py-3">
          <a href="{{ url_for('sessions.detail', session_id=s.id) }}"
             class="text-xs text-blue-600 hover:underline font-medium">
            View â†’
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% else %}
<div class="text-center py-20 bg-white rounded-xl border border-dashed border-slate-300">
  <div class="text-5xl mb-4">ðŸ—‚</div>
  <h2 class="text-lg font-semibold text-slate-700 mb-1">No history yet</h2>
  <p class="text-sm text-slate-500 mb-6">Your completed sessions will appear here.</p>
  <a href="{{ url_for('sessions.new_session') }}"
     class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold
            px-5 py-2.5 rounded-md transition-colors">
    Create Your First Session
  </a>
</div>
{% endif %}

{% endblock %}